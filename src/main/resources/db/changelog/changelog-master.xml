<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog 
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext
   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd 
   http://www.liquibase.org/xml/ns/dbchangelog 
   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
     
     <property name="author" value="Subhodip"/>
      
    <changeSet id="1" author="${author}" >
        <preConditions onFail="MARK_RAN">
			<not><tableExists  tableName="ACTION" /></not>
		</preConditions>
		
        <createTable tableName="ACTION">
        
        	<column name="id" type="BIGINT(20)" autoIncrement="true">
            	<constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="main_class" type="varchar(255)">
            	<constraints nullable="true"/>
            </column>
            <column name="memory" type="int(11)" >
            <constraints nullable="true"/>
            </column>
            <column name="name" type="varchar(255)" >
			<constraints nullable="true"/>
            </column>
            <column name="timeout" type="int(11)" >
            	<constraints nullable="true"/>
            </column>
           
        </createTable>
       <createIndex tableName="ACTION" indexName="ACTION_IDX">
			<column name="id"/>
		</createIndex>
	</changeSet>
	<changeSet id="2" author="${author}" >
        <preConditions onFail="MARK_RAN">
			<not><tableExists  tableName="FIU" /></not>
		</preConditions>
		
        <createTable tableName="FIU">
            <column name="id" type="BIGINT(20)" autoIncrement="true">
            	<constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(255)" >
            <constraints nullable="true"/>
            </column>
            <column name="username" type="varchar(255)" >
            <constraints nullable="false"/>
            </column>  
            <column name="password" type="varchar(255)" >
            <constraints nullable="false"/>
            </column>      
        </createTable>
       <createIndex tableName="FIU" indexName="FIU_IDX">
			<column name="id" />
		</createIndex>
	</changeSet>
	<changeSet id="3" author="${author}" >
        <preConditions onFail="MARK_RAN">
			<not><tableExists  tableName="EXECUTION" /></not>
		</preConditions>
		
        <createTable tableName="EXECUTION">
            <column name="id" type="BIGINT(20)" autoIncrement="true">
            	<constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="activation_id" type="varchar(255)" >
            <constraints nullable="false"/>
            </column>
            <column name="output" type="varchar(255)" >
            <constraints nullable="false"/>
            </column>
            <column name="status" type="varchar(255)" >
            <constraints nullable="false"/>
            </column>
            <column name="timestamp" type="DATETIME">
            	<constraints nullable="false"/>
            </column>
            <column name="action_id" type="BIGINT(20)">
            	<constraints nullable="false"/>
            </column>
            <column name="fiu_id" type="BIGINT(20)">
            	<constraints nullable="false"/>
            </column>
            
        </createTable>
       <createIndex tableName="EXECUTION" indexName="EXECUTION_IDX">
			<column name="id" />
			<column name="action_id" />
			<column name="fiu_id" />
		</createIndex>
	        <addForeignKeyConstraint baseColumnNames="FIU_ID"
             baseTableName="EXECUTION"
             constraintName="fk_fiu_id"
             referencedColumnNames="id"
             referencedTableName="FIU"
           	/>
           <addForeignKeyConstraint baseColumnNames="ACTION_ID"
          baseTableName="EXECUTION"
          constraintName="fk_action_id"
          referencedColumnNames="id"
          referencedTableName="ACTION"
           />
	</changeSet>
	<changeSet id="4" author="${author}" >
        <preConditions onFail="MARK_RAN">
			<not><tableExists  tableName="FIU_ACTIONS" /></not>
		</preConditions>
		
        <createTable tableName="FIU_ACTIONS">
            <column name="id" type="varchar(255)">
            	<constraints nullable="false"/>
            </column>
            <column name="action_id" type="varchar(255)" >
            <constraints nullable="false"/>
            </column>
            
        </createTable>
       <createIndex tableName="FIU_ACTIONS" indexName="FIU_ACTIONS_IDX">
			<column name="id" />
		</createIndex>
		<addPrimaryKey
	        columnNames="id"
	        constraintName="FIU_ACTIONS_PK"
	        tableName="FIU_ACTIONS"
	        />
	        
	</changeSet>
	<changeSet id="5" author="${author}" >
            <preConditions onFail="MARK_RAN" >          
                      <not><columnExists tableName="FIU" columnName="apikey" /></not>
            </preConditions>
            <addColumn tableName="FIU">
        <column name="apikey" type="varchar(255)"/>
       
    </addColumn> 
</changeSet>
	
</databaseChangeLog>